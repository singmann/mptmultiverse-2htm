<!DOCTYPE html>
<html>
  <head>
    <title>A Multiverse Pipeline for MPT models</title>
    <meta charset="utf-8">
    <meta name="author" content="Henrik Singmann (Twitter: @HenrikSingmann) Georgia Eleni Kapetaniou University of Zurich" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# A Multiverse Pipeline for MPT models
## Applications to Recognition Memory
### Henrik Singmann (Twitter: <a href='https://twitter.com/HenrikSingmann'><span class="citation">@HenrikSingmann</span></a>)<br/>Georgia Eleni Kapetaniou<br/>University of Zurich
### April 2018

---







class: inline-grey
# Summary: Analysis with Statistical Models in R

1. Identify probability distribution of data (more correct: of residuals/conditional distribution)
2. Make sure variables are of correct type via `str()`
3. Set appropriate contrasts (orthogonal contrasts if model includes interaction): `afex::set_sum_contrasts()`
4. Describe statistical model using `formula`
4. Fit model: pass `formula` and `data.frame` to corresponding modeling function (e.g., `lm()`, `glm()`)
4. Check model fit (e.g., inspect residuals)
5. Test terms (i.e., main effects and interactions): Pass fitted model to `car::Anova()`
7. Follow-up tests: 
   - Estimated marginal means: Pass fitted model to `lsmeans::lsmeans()`/`emmeans::emmeans()`
   - Specify specific contrasts on estimated marginal means (e.g., `contrast()`, `pairs()`)

`afex` combines fitting (5.) and testing (7.):
- ANOVAs: `afex::aov_car()`, `afex::aov_ez()`, or `afex::aov_4()`
- (Generalized) linear mixed-effects models: `afex::mixed()`

---

# Overview: Part I

- Statistical Modeling with `lm` (no mixed-model)
    - Model setup and model formulas
    - Continuous versus categorical covariates 
    - `model.matrix()` and factor codings.
    - Categorical covariates and interactions

- Tests of Model Terms/Effects with `car::Anova()`
- Follow-up Tests with `lsmeans`/`emmeans`
- ANOVAs with `afex`
- Problem with Repeated-Measures: IID assumption


---
class: small

# Some Example Data

Data from Revelle, Wilt and Rosenthal (2009). `?sat.act`:
&gt; Items were collected as part of the SAPA project (http://sapa-project.org) to develop online measures of ability (Revelle, Wilt and Rosenthal, 2009). The score means are higher than national norms suggesting both self selection for people taking on line personality and ability tests and a self reporting bias in scores.


```
##     gender    education      age            ACT            SATV          SATQ    
##  male  :247   0: 57     Min.   :13.0   Min.   : 3.0   Min.   :200   Min.   :200  
##  female:453   1: 45     1st Qu.:19.0   1st Qu.:25.0   1st Qu.:550   1st Qu.:530  
##               2: 44     Median :22.0   Median :29.0   Median :620   Median :620  
##               3:275     Mean   :25.6   Mean   :28.6   Mean   :612   Mean   :610  
##               4:138     3rd Qu.:29.0   3rd Qu.:32.0   3rd Qu.:700   3rd Qu.:700  
##               5:141     Max.   :65.0   Max.   :36.0   Max.   :800   Max.   :800  
##                                                                     NA's   :13
```


---
# Linear Regression Model

- `\(\bf{y}\)` = vector of ACT scores of length `\(n\)` (*dependent variable*)
- `\(\bf{x_{\mbox{SATV}}}\)` = vector of SATV scores of length `\(n\)` (*independent variable* or *covariate*)

`$$y_i = \beta_0x_{0,i}+\beta_{\mbox{SATV}}x_{\mbox{SATV},i}+\epsilon_i, \ \ i = 1, ..., n, \\
\bf{\epsilon} \sim \mathcal{N}(0, \sigma^2_{\epsilon}),$$`
where `\(\bf{x_0}\)` is a vector of 1s of length `\(n\)`.

- Errors `\(\bf{\epsilon}\)` are assumed to come from a normal distribution (i.e., uncorrelated).

- `\(\beta_0\)` and  `\(\beta_{\mbox{SATV}}\)` are scalars (i.e., of length 1) and called *regression coefficients* or *parameters* ( `\(\sigma^2_{\epsilon}\)` is also a parameter). `\(\beta_0\)` is also known as the *intercept*.

******

In matrix form this model can be expressed as:
`$$\bf{y} = \bf{X}\bf{\beta}+\bf{\epsilon}$$`

---
class: small

# Linear Model in R

.pull-left2[

```r
m1 &lt;- lm(ACT ~ SATQ, sat.act)
summary(m1)
```

```
## 
## Call:
## lm(formula = ACT ~ SATQ, data = sat.act)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -20.394  -2.573   0.267   2.267  16.511 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 13.58325    0.80249    16.9   &lt;2e-16 ***
## SATQ         0.02453    0.00129    19.0   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.91 on 685 degrees of freedom
## Multiple R-squared:  0.345,	Adjusted R-squared:  0.344 
## F-statistic:  360 on 1 and 685 DF,  p-value: &lt;2e-16
```

]
.pull-right2[

```r
coef(m1)
```

```
## (Intercept)        SATQ 
##    13.58325     0.02453
```


```r
plot(sat.act$SATQ, sat.act$ACT)
abline(m1)
```

![](multiverse_2htm_files/figure-html/unnamed-chunk-4-1.svg)&lt;!-- --&gt;
]
---
class: small

# Linear Model in R (Centered)

.pull-left2[

```r
sat.act$SATQ_c &lt;- sat.act$SATQ - mean(sat.act$SATQ, na.rm = TRUE)
sat.act$SATV_c &lt;- sat.act$SATV - mean(sat.act$SATV)
m2 &lt;- lm(ACT ~ SATQ_c, sat.act)
summary(m2)
```

```
## 
## Call:
## lm(formula = ACT ~ SATQ_c, data = sat.act)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -20.394  -2.573   0.267   2.267  16.511 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 28.55022    0.14931     191   &lt;2e-16 ***
## SATQ_c       0.02453    0.00129      19   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.91 on 685 degrees of freedom
## Multiple R-squared:  0.345,	Adjusted R-squared:  0.344 
## F-statistic:  360 on 1 and 685 DF,  p-value: &lt;2e-16
```

]
.pull-right2[

```r
coef(m2)
```

```
## (Intercept)      SATQ_c 
##    28.55022     0.02453
```


```r
plot(sat.act$SATQ_c, sat.act$ACT)
abline(m2)
```

![](multiverse_2htm_files/figure-html/unnamed-chunk-7-1.svg)&lt;!-- --&gt;
]
---

class: inline-grey
# Formula Interface for Statistical Models: `~`

Allows symbolic specification of statistical model, e.g. linear models: `lm(ACT ~ SATQ, sat.act)`

Everything to the left of `~` is the dependent variable:
```r
y ~ x # univariate model
cbind(y1, y2, y3) ~ x # multivariate model
~ x # one sided formula
```

Independent variables are to the right of the `~`:

| Formula | &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; | Interpretation  |
| ------------------------|---|----------------------------------|
| `~ x` or `~1+x`         || Intercept and main effect of `x` | 
| ` ~ x-1` or `~0 + x`    || Only main effect of `x` and no intercept (questionable) |
| `~ x+y`                 || Main effects of `x` and `y`|
| `~ x:y`                 || Interaction between `x` and `y` (and no main effect) |
| `~ x*y` or `~ x+y+x:y`  || Main effects and interaction between `x` and `y` |

---
class: small

# How many Parameters in each Model?


```r
lm(ACT ~ SATQ_c + SATV_c, sat.act)   # a
lm(ACT ~ SATQ_c : SATV_c, sat.act)   # b
lm(ACT ~ 0 + SATQ_c:SATV_c, sat.act) # c
lm(ACT ~ SATQ_c*SATV_c, sat.act)     # d
lm(ACT ~ 0+SATQ_c*SATV_c, sat.act)   # e
```

--
.pull-left[

```r
coef(lm(ACT ~ SATQ_c + SATV_c, sat.act))   # a
```

```
## (Intercept)      SATQ_c      SATV_c 
##    28.55022     0.01614     0.01328
```

```r
coef(lm(ACT ~ SATQ_c : SATV_c, sat.act))   # b
```

```
##   (Intercept) SATQ_c:SATV_c 
##     2.895e+01    -4.757e-05
```

```r
coef(lm(ACT ~ 0 + SATQ_c:SATV_c, sat.act)) # c
```

```
## SATQ_c:SATV_c 
##     0.0006005
```


]

.pull-right[

```r
coef(lm(ACT ~ SATQ_c*SATV_c, sat.act))     # d
```

```
##   (Intercept)        SATQ_c        SATV_c SATQ_c:SATV_c 
##     2.832e+01     1.701e-02     1.432e-02     2.780e-05
```

```r
coef(lm(ACT ~ 0+SATQ_c*SATV_c, sat.act))   # e
```

```
##        SATQ_c        SATV_c SATQ_c:SATV_c 
##     0.0397598     0.0416544     0.0007596
```

]




---
class: center, middle, inverse

# Categorical Covariates

---
class: small
# Categorical Covariates

`R` modeling functions behave differently for numerical and categorical covariates. 

It is important to always know of what type variables are. Use `str()` on a `data.frame` to obtain information regarding the structure, including variable types: 


```r
str(sat.act)
```

```
## 'data.frame':	687 obs. of  8 variables:
##  $ gender   : Factor w/ 2 levels "male","female": 2 2 2 1 1 1 2 1 2 2 ...
##  $ education: Factor w/ 6 levels "0","1","2","3",..: 4 4 4 5 3 6 6 4 5 6 ...
##  $ age      : int  19 23 20 27 33 26 30 19 23 40 ...
##  $ ACT      : int  24 35 21 26 31 28 36 22 22 35 ...
##  $ SATV     : int  500 600 480 550 600 640 610 520 400 730 ...
##  $ SATQ     : int  500 500 470 520 550 640 500 560 600 800 ...
##  $ SATQ_c   : num  -110.2 -110.2 -140.2 -90.2 -60.2 ...
##  $ SATV_c   : num  -112.3 -12.3 -132.3 -62.3 -12.3 ...
##  - attr(*, "na.action")=Class 'omit'  Named int [1:13] 130 197 248 364 376 419 498 515 523 581 ...
##   .. ..- attr(*, "names")= chr [1:13] "31294" "32448" "33259" "35106" ...
```

- Numerical covariates are `int` or `num`.
- Categorical covariates are `Factor` (or `character`).

**Make sure all categorical variables are factors before adding them to a statistical model!**

---
# Categorical Covariates and Model Matrices

.pull-left3[

```r
lm(ACT ~ SATQ + SATV, sat.act)   # a: 3
lm(ACT ~ SATQ : SATV, sat.act)   # b: 2
lm(ACT ~ 0 + SATQ:SATV, sat.act) # c: 1
lm(ACT ~ SATQ*SATV, sat.act)     # d: 4
lm(ACT ~ 0+SATQ*SATV, sat.act)   # e: 3

lm(ACT ~ SATQ, sat.act)          # f: 2
lm(ACT ~ 0 + SATQ, sat.act)      # g: 1
```

]

--
.pull-right3[

```r
lm(ACT ~ gender, sat.act)                  # a
lm(ACT ~ 0+gender, sat.act)                # b
lm(ACT ~ gender+education, sat.act)        # c
lm(ACT ~ 0+gender+education, sat.act)      # d
lm(ACT ~ gender:education, sat.act)        # e
lm(ACT ~ 0+gender:education, sat.act)      # f
lm(ACT ~ gender*education, sat.act)        # g
lm(ACT ~ 0+gender*education, sat.act)      # h
lm(ACT ~ gender+gender:education, sat.act) # i
```


```r
levels(sat.act$gender)
```

```
## [1] "male"   "female"
```

```r
levels(sat.act$education)
```

```
## [1] "0" "1" "2" "3" "4" "5"
```


]



---
### References 
- Bröder, A., Kellen, D., Schütz, J., &amp; Rohrmeier, C. (2013). Validating a two-high-threshold measurement model for confidence rating data in recognition. *Memory*, 21(8), 916–944. https://doi.org/10.1080/09658211.2013.767348
- Dube, C., Starns, J. J., Rotello, C. M., &amp; Ratcliff, R. (2012). Beyond ROC curvature: Strength effects and response time data support continuous-evidence models of recognition memory. *Journal of Memory and Language*, 67(3), 389–406. https://doi.org/10.1016/j.jml.2012.06.002
- Jaeger, A., Cox, J. C., &amp; Dobbins, I. G. (2012). Recognition confidence under violated and confirmed memory expectations. *Journal of Experimental Psychology: General*, 141(2), 282–301. https://doi.org/10.1037/a0025687
- Koen, J. D., Aly, M., Wang, W.-C., &amp; Yonelinas, A. P. (2013). Examining the causes of memory strength variability: Recollection, attention failure, or encoding variability? *Journal of Experimental Psychology: Learning, Memory, and Cognition*, 39(6), 1726–1741. https://doi.org/10.1037/a0033671
- Steegen, S., Tuerlinckx, F., Gelman, A., &amp; Vanpaemel, W. (2016). Increasing Transparency Through a Multiverse Analysis. *Perspectives on Psychological Science*, 11(5), 702–712. https://doi.org/10.1177/1745691616658637
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
